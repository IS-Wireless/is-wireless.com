<template>
  <nav class="w-full relative bg-black z-30">
    <div class="mx-auto w-4/5 flex justify-between">
      <nuxt-link to="/">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 1367 463"
          fill-rule="evenodd"
          clip-rule="evenodd"
          stroke-linejoin="round"
          stroke-miterlimit="2"
          class="block h-full py-4"
          width="180px"
        >
          <g fill="#fff">
            <path
              d="M258.413 168.229c8.05 0 14.583 6.946 14.583 15.496s-6.533 15.496-14.583 15.496c-8.046-.004-14.58-6.946-14.58-15.496s6.534-15.492 14.58-15.492v-.004z"
            ></path>
            <path
              d="M218.317 249.833c-45.838-44.062-66.504-104.433-39.363-135.437 27.354-31.258 91.021-20.804 141.471 23.35 23.65 20.704 40.617 45.146 48.842 68.483l13.196-.062c-11.655-25.988-30.892-52.238-56.809-74.917-65.241-57.113-147.354-69.987-183.441-28.758-36.105 41.233-13.625 120.954 51.629 178.07 8.308 7.276 20.308 13.821 24.475 19.642v-50.371zM1314.63 205.742v-26.984h-9.629v-5.487h25.783v5.487h-9.608v26.984h-6.546zm20.3 0v-32.471h9.813l5.891 22.133 5.838-22.133h9.825v32.471h-6.104v-25.563l-6.45 25.563h-6.292l-6.438-25.563v25.563h-6.083z"
              fill-rule="nonzero"
            ></path>
            <path
              d="M267.746 317.921c0 7.646-9.425 8.079-14.988 6.292-2.612-.801-3.916-2.896-3.916-6.292v-90.396c0-3.408 1.304-5.492 3.916-6.283.9-.23 3.696-.359 8.354-.359 4.413 0 6.634 2.225 6.634 6.642v90.396zM400.508 299.121c0 5.529-.866 9.862-2.625 13.058-4.854 8.471-19.087 12.679-42.795 12.679h-65.505c-4.362 0-6.533-2.241-6.533-6.712 0-3.025.313-5.121.925-6.321.95-1.717 2.85-2.542 5.608-2.542h65.525c17.646 0 26.496-3.262 26.496-9.804v-8.933c0-6.488-8.537-9.942-25.642-10.404-29.137-.85-45.004-1.521-47.637-1.942-17.017-2.917-25.529-10.538-25.529-22.833v-7.859c0-12.379 6.675-20.345 20.062-23.929 6.205-1.662 17.984-2.471 35.284-2.471 4.437 0 6.658 2.209 6.658 6.646v2.054c0 4.475-2.221 6.725-6.658 6.725h-8.529c-18.642 0-27.942 3.613-27.942 10.863v7.216c0 4.53 3.912 7.48 11.662 8.83 3.155.533 8.696.758 16.721.758h25.288c11.266 0 20.808 1.571 28.641 4.713 11.03 4.42 16.525 11.408 16.525 20.933v9.275zM488.025 271.412c0 5.517-2.546 8.263-7.65 8.263h-63.638c-3.787 0-6.041-.687-6.895-2.013-.517-.979-.788-3.52-.788-7.674 0-5.5 2.559-8.271 7.675-8.271h63.634c3.608 0 5.829.7 6.683 2.037.621.904.958 3.442.958 7.658m198.625-41.691c0 1.566-.5 3.354-1.45 5.333l-37.916 80.696c-2.23 4.758-6.321 7.104-12.438 7.104-5.804 0-9.833-2.271-12.121-6.883l-30.154-62.013-30.646 62.238c-2.312 4.675-6.479 6.996-12.521 6.996-6.246 0-10.504-2.429-12.679-7.321l-37.179-80.817c-.896-2.754-1.35-4.525-1.35-5.333 0-4.817 3.204-7.225 9.633-7.225 5.529 0 9.175 1.687 10.875 5l31.371 66.567 30.692-61.984c2.358-4.967 6.308-7.437 11.8-7.437 5.3 0 9.15 2.437 11.646 7.333l30.62 62.088 31.338-66.567c1.563-3.313 5.146-5 10.771-5 6.458 0 9.683 2.408 9.683 7.225M722.588 209c0 3.708-1.413 6.604-4.267 8.742-2.454 1.833-5.458 2.766-9.008 2.766-3.551 0-6.559-.933-9.001-2.766-2.845-2.138-4.27-5.034-4.27-8.742 0-3.663 1.425-6.554 4.27-8.704 2.446-1.85 5.455-2.754 9.001-2.754 3.545 0 6.55.904 9.008 2.754 2.854 2.15 4.267 5.041 4.267 8.704zm-2.826 107.471c0 5.591-2.533 8.387-7.629 8.387-5.012 0-7.929-.254-8.754-.729-2.646-1.041-3.967-3.621-3.967-7.658v-85.559c0-5.549 2.555-8.312 7.642-8.312 4.917 0 7.817.271 8.633.762 2.734 1.059 4.067 3.576 4.067 7.55v85.559h.008zm73.538-82.9c0 5.625-3.063 8.416-9.117 8.416-.837 0-2.058-.07-3.633-.179-1.592-.116-2.829-.162-3.654-.162-15.713 0-23.563 4.296-23.563 12.862v61.963c0 4.112-1.433 6.721-4.262 7.771-1.167.408-4.129.616-8.917.616-4.841 0-7.304-2.837-7.304-8.487v-61.863c0-13.329 6.246-22.354 18.717-27.104 7.65-2.983 18.991-4.471 34.045-4.471 5.13 0 7.671 3.55 7.671 10.638m133.55 42.092c0 6.166-1.945 9.241-5.729 9.241H819.371v.725c0 9.654 5.179 15.829 15.541 18.588 2.234.591 5.513 1.012 9.817 1.337 4.317.321 9.804.479 16.429.479 5.055 0 7.542 3.475 7.542 10.404 0 5.625-2.492 8.421-7.546 8.421-6.825 0-12.462-.025-16.821-.141-4.341-.113-7.691-.296-9.945-.588-11.263-1.275-19.525-4.175-24.805-8.712-7.604-6.438-11.375-14.042-11.375-22.734v-37.525c0-11.783 5.829-20.487 17.438-26.166 7.971-4.088 18.517-6.171 31.637-6.171h38.221c10.709 0 19.592 1.958 26.663 5.854 9.77 4.963 14.629 12.433 14.629 22.425v24.563h.037zm-19.983-10.184v-12.575c0-7.65-13.879-11.462-41.613-11.462-16.349 0-27.591.658-33.658 1.933-8.608 1.775-12.904 5.212-12.904 10.408v11.696h88.175zm52.25 50.992c0 5.591-2.525 8.387-7.542 8.387-4.995 0-7.925-.254-8.741-.729-2.775-1.121-4.167-3.708-4.167-7.658V203.717c0-5.567 2.496-8.313 7.542-8.313 4.737 0 7.683.2 8.845.642 2.721.987 4.059 3.562 4.059 7.671v112.754h.004zm140.358-40.808c0 6.166-1.912 9.241-5.716 9.241H992.008v.725c0 9.654 5.188 15.829 15.521 18.588 2.254.591 5.521 1.012 9.825 1.337 4.304.321 9.792.479 16.442.479 5.025 0 7.558 3.475 7.558 10.404 0 5.625-2.533 8.421-7.558 8.421-6.85 0-12.488-.025-16.846-.141-4.346-.113-7.679-.296-9.925-.588-11.258-1.275-19.538-4.175-24.833-8.712-7.58-6.438-11.371-14.042-11.371-22.734v-37.525c0-11.783 5.829-20.487 17.446-26.166 7.983-4.088 18.516-6.171 31.633-6.171h38.221c10.729 0 19.621 1.958 26.671 5.854 9.795 4.963 14.645 12.433 14.645 22.425v24.563h.021zm-19.995-10.184v-12.575c0-7.65-13.871-11.462-41.596-11.462-16.375 0-27.584.658-33.654 1.933-8.6 1.775-12.892 5.212-12.892 10.408v11.696h88.142zm146.07 30.242c0 19.416-13.504 29.137-40.545 29.137h-69.213c-5.079 0-7.571-2.796-7.571-8.421 0-6.929 2.488-10.404 7.525-10.404h69.358c12.801 0 19.188-3.446 19.188-10.312v-3.809c0-6.17-5.842-9.245-17.429-9.245h-33.296c-30.575 0-45.888-9.375-45.888-28.05v-5.559c0-12.362 7.696-20.312 23.067-23.8 3.125-.758 7.654-1.329 13.642-1.745 5.958-.392 13.483-.58 22.587-.58 5.08 0 7.604 3.55 7.604 10.638 0 5.5-2.524 8.275-7.608 8.275h-14.75c-7.75 0-12.317.1-13.883.316-6.775.988-10.188 3.3-10.188 6.896v5.338c0 6.104 8.492 9.137 25.525 9.137h33.884c25.321 0 37.95 9.188 37.95 27.534v4.654h.041zm126.113 0c0 19.416-13.521 29.137-40.546 29.137h-69.233c-5.071 0-7.579-2.796-7.579-8.421 0-6.929 2.504-10.404 7.545-10.404h69.354c12.792 0 19.2-3.446 19.2-10.312v-3.809c0-6.17-5.833-9.245-17.458-9.245h-33.246c-30.629 0-45.908-9.375-45.908-28.05v-5.559c0-12.362 7.696-20.312 23.067-23.8 3.125-.758 7.65-1.329 13.65-1.745 5.946-.392 13.45-.58 22.554-.58 5.1 0 7.642 3.55 7.642 10.638 0 5.5-2.546 8.275-7.646 8.275h-14.738c-7.712 0-12.329.1-13.891.316-6.763.988-10.184 3.3-10.184 6.896v5.338c0 6.104 8.509 9.137 25.504 9.137h33.946c25.292 0 37.942 9.188 37.942 27.534v4.654h.025z"
              fill-rule="nonzero"
            ></path>
            <path
              d="M424.487 361.05c-52.099 49.512-161.512 29.204-249.645-47.946-91.334-79.958-125.213-190.675-75.65-247.287 49.55-56.609 163.771-37.68 255.112 42.279 34.05 29.8 60.092 63.875 76.825 97.821l21.558-.104c-21.333-38.28-51.612-76.025-89.833-109.484C244.708-7.092 95.954-30.4 30.6 44.254c-65.358 74.671-22.567 219.025 95.575 322.45 118.154 103.425 266.9 126.734 332.263 52.075 9.191-10.504 16.17-22.421 21.175-35.375l-55.126-22.354z"
              fill-rule="nonzero"
            ></path>
          </g>
        </svg>
      </nuxt-link>
      <div class="grow flex items-center justify-end">
        <ul
          class="h-full flex-shrink-0 hidden tablet-wide:flex items-center justify-end"
        >
          <li
            v-for="item in mainMenu"
            :key="item.id"
            class="navbar-item flex group text-white"
          >
            <CustomLink
              class="p-4 flex h-full justify-center items-center text-base overflow-hidden relative after:bg-blue-main after:content-[''] after:absolute after:block after:left-0 after:-bottom-1 after:h-1 after:w-full after:transform after:transition hover:after:-translate-y-1 transition duration-200"
              :class="
                item.object == 'custom'
                  ? 'text-blue-main hover:text-blue-main'
                  : 'text-white'
              "
              :url="item.url"
              :title="item.title.rendered"
              :isExternal="item.object == 'custom' ? true : false"
            ></CustomLink>
            <div
              class="absolute top-full left-0 hidden hover:flex group-hover:flex px-5 w-full bg-[#232323] cursor-default"
            >
              <ul class="w-4/5 mx-auto flex">
                <li
                  v-for="subItem in item.children"
                  :key="subItem.id"
                  class="basis-1/4 grow-0 flex"
                >
                  <div class="menu-sub-col">
                    <CustomLink
                      class="text-base block uppercase font-bold transition duration-200 mt-7 mb-6"
                      :class="
                        subItem.object == 'custom'
                          ? 'text-blue-main hover:text-blue-main'
                          : 'text-white hover:text-blue-main'
                      "
                      :url="subItem.url"
                      :title="subItem.title.rendered"
                      :isExternal="subItem.object == 'custom' ? true : false"
                    ></CustomLink>
                    <ul class="flex flex-col mb-5">
                      <li
                        v-for="subSubItem in subItem.children"
                        :key="subSubItem.id"
                      >
                        <CustomLink
                          class="py-1.5 block text-sm transition duration-200"
                          :class="
                            subSubItem.object == 'custom'
                              ? 'text-blue-main hover:text-blue-main'
                              : 'text-white hover:text-blue-main'
                          "
                          :url="subSubItem.url"
                          :title="subSubItem.title.rendered"
                          :isExternal="
                            subSubItem.object == 'custom' ? true : false
                          "
                        ></CustomLink>
                      </li>
                    </ul>
                  </div>
                </li>
              </ul>
            </div>
          </li>
        </ul>
        <ul class="h-full flex items-center overflow-hidden">
          <li
            class="navbar-item flex p-4 justify-center items-center h-full text-base text-inherit hover:text-inherit relative after:bg-blue-main after:content-[''] after:absolute after:block after:left-0 after:-bottom-1 after:h-1 after:w-full after:transform after:transition hover:after:-translate-y-1"
            @click="toggleExpanded"
          >
            <svg
              width="25"
              height="35"
              viewBox="12 0 25 39"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <rect x="13" y="10" width="25" height="3" rx="1" fill="#FFFFFF" />
              <rect x="13" y="18" width="25" height="3" rx="1" fill="#FFFFFF" />
              <rect x="13" y="26" width="25" height="3" rx="1" fill="#FFFFFF" />
            </svg>
          </li>
          <li
            class="navbar-item hidden tablet-wide:flex p-4 justify-center items-center h-full text-base text-inherit hover:text-inherit relative after:bg-blue-main after:content-[''] after:absolute after:block after:left-0 after:-bottom-1 after:h-1 after:w-full after:transform after:transition hover:after:-translate-y-1"
            @click="toggleMainSearch()"
          >
            <svg
              width="16"
              height="16"
              viewBox="0 0 25 25"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M24.8564 24.8563C25.0479 24.6647 25.0479 24.3545 24.8563 24.163L17.6572 16.9639L17.6867 16.9311C19.3076 15.1315 20.3038 12.7588 20.3038 10.1518C20.3037 4.55414 15.7496 0 10.1519 0C4.55414 0 0 4.55414 0 10.1519C0 15.7496 4.55414 20.3038 10.1519 20.3038C12.7588 20.3038 15.1315 19.3076 16.9312 17.6867L16.9639 17.6573L24.163 24.8563C24.2587 24.9521 24.3843 25 24.5097 25C24.6351 25 24.7606 24.9521 24.8564 24.8563ZM10.1519 19.323C5.09531 19.323 0.980748 15.209 0.980748 10.1519C0.980748 5.09482 5.09531 0.980687 10.1519 0.980687C15.2085 0.980687 19.323 5.09476 19.323 10.1519C19.323 15.209 15.2085 19.323 10.1519 19.323Z"
                fill="#FFFFFF"
              />
            </svg>
          </li>
        </ul>
        <div
          class="absolute top-0 right-0 w-full h-full hidden tablet-wide:block pointer-events-none"
        >
          <div class="mx-auto w-4/5 h-full flex overflow-hidden">
            <span class="w-[200px] shrink-0" />
            <form
              class="flex flex-row h-full grow bg-[#111] transition duration-300 pointer-events-auto"
              action="/search/"
              :class="{ 'translate-x-full': !mainSearch }"
            >
              <button
                class="px-5 flex justify-center items-center text-white hover:text-blue-main"
              >
                <svg
                  class="fill-current transition"
                  width="16"
                  height="16"
                  viewBox="0 0 25 25"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    d="M24.8564 24.8563C25.0479 24.6647 25.0479 24.3545 24.8563 24.163L17.6572 16.9639L17.6867 16.9311C19.3076 15.1315 20.3038 12.7588 20.3038 10.1518C20.3037 4.55414 15.7496 0 10.1519 0C4.55414 0 0 4.55414 0 10.1519C0 15.7496 4.55414 20.3038 10.1519 20.3038C12.7588 20.3038 15.1315 19.3076 16.9312 17.6867L16.9639 17.6573L24.163 24.8563C24.2587 24.9521 24.3843 25 24.5097 25C24.6351 25 24.7606 24.9521 24.8564 24.8563ZM10.1519 19.323C5.09531 19.323 0.980748 15.209 0.980748 10.1519C0.980748 5.09482 5.09531 0.980687 10.1519 0.980687C15.2085 0.980687 19.323 5.09476 19.323 10.1519C19.323 15.209 15.2085 19.323 10.1519 19.323Z"
                  />
                </svg>
              </button>
              <input
                ref="searchInput"
                type="text"
                name="q"
                placeholder="Search here..."
                class="w-full px-5 bg-[#111] text-base text-white focus-visible:outline-none"
              />
              <div
                class="px-5 h-full flex justify-center items-center cursor-pointer text-white hover:text-white/70"
                @click="toggleMainSearch()"
              >
                <svg
                  class="text-inherit fill-current transition"
                  width="30"
                  height="30"
                  viewBox="0 0 52 52"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <rect
                    x="17.0625"
                    y="15.0002"
                    width="28.1956"
                    height="2.91678"
                    rx="1"
                    transform="rotate(45 17.0625 15.0002)"
                  />
                  <rect
                    x="15"
                    y="34.9373"
                    width="28.1956"
                    height="2.91679"
                    rx="1"
                    transform="rotate(-45 15 34.9373)"
                  />
                </svg>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
    <div
      class="fixed flex z-40 top-0 left-0 w-full h-screen overflow-hidden"
      :class="{ 'pointer-events-none': !expanded }"
    >
      <div
        class="w-full transition duration-300"
        :class="{ 'bg-[#3F3F3F]/70': expanded }"
        @click="toggleExpanded"
      />
      <div
        class="absolute z-50 top-0 left-full w-full tablet-wide:w-[300px] h-screen bg-[#242424] transform transition duration-300"
        :class="{ '-translate-x-full ': expanded }"
      >
        <div
          class="w-8 ml-5 mt-3 cursor-pointer text-white hover:text-white/80"
          @click="toggleExpanded"
        >
          <svg
            class="text-inherit fill-current transition"
            width="30"
            height="30"
            viewBox="0 0 52 52"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <rect
              x="17.0625"
              y="15.0002"
              width="28.1956"
              height="2.91678"
              rx="1"
              transform="rotate(45 17.0625 15.0002)"
            />
            <rect
              x="15"
              y="34.9373"
              width="28.1956"
              height="2.91679"
              rx="1"
              transform="rotate(-45 15 34.9373)"
            />
          </svg>
        </div>
        <div class="px-7 tablet-wide:hidden">
          <form
            class="mt-10 flex w-full border border-solid border-white focus-visible:outline-none"
            action="/search/"
          >
            <input
              type="search"
              name="q"
              placeholder="Search..."
              class="px-5 grow bg-[#A7A7A7]/30 text-white focus-visible:outline-none focus:outline-none font-lato appearance-none"
            />
            <button
              type="submit"
              class="flex items-center justify-center w-[50px] h-[48px] bg-white text-[#555] hover:text-blue-main"
            >
              <svg
                class="fill-current transition"
                width="18"
                height="18"
                viewBox="0 0 25 25"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M24.8564 24.8563C25.0479 24.6647 25.0479 24.3545 24.8563 24.163L17.6572 16.9639L17.6867 16.9311C19.3076 15.1315 20.3038 12.7588 20.3038 10.1518C20.3037 4.55414 15.7496 0 10.1519 0C4.55414 0 0 4.55414 0 10.1519C0 15.7496 4.55414 20.3038 10.1519 20.3038C12.7588 20.3038 15.1315 19.3076 16.9312 17.6867L16.9639 17.6573L24.163 24.8563C24.2587 24.9521 24.3843 25 24.5097 25C24.6351 25 24.7606 24.9521 24.8564 24.8563ZM10.1519 19.323C5.09531 19.323 0.980748 15.209 0.980748 10.1519C0.980748 5.09482 5.09531 0.980687 10.1519 0.980687C15.2085 0.980687 19.323 5.09476 19.323 10.1519C19.323 15.209 15.2085 19.323 10.1519 19.323Z"
                />
              </svg>
            </button>
          </form>
        </div>
        <ul class="flex flex-col px-7 mt-10">
          <li
            v-for="(item, index) in sideMenu"
            :key="item.id"
            class="mb-3"
            :class="{
              'tablet-wide:hidden': index < 4,
            }"
          >
            <CustomLink
              class="text-xl text-white hover:text-blue-main transition"
              :url="item.url"
              :title="item.title.rendered"
              :isExternal="item.object == 'custom' ? true : false"
              @click.native="toggleExpanded()"
            ></CustomLink>
          </li>
        </ul>
      </div>
    </div>
  </nav>
</template>

<script>
import CustomLink from './custom-link.vue'

import { useFocus } from '@vueuse/core'
import { ref } from '@vue/composition-api'
export default {
  name: 'Navbar',
  components: {
    CustomLink,
  },
  props: {
    mainMenu: {
      type: Array,
      required: true,
    },
    sideMenu: {
      type: Array,
      required: true,
    },
  },
  data() {
    return {
      expanded: false,
      mainSearch: false,
    }
  },
  setup() {
    const searchInput = ref()
    const { focused } = useFocus(searchInput, { initialValue: false })
    return { searchInput, focused }
  },
  methods: {
    toggleExpanded() {
      this.expanded = !this.expanded
    },

    toggleMainSearch() {
      this.mainSearch = !this.mainSearch
      if (this.mainSearch) {
        setTimeout(
          function () {
            this.focused = true
          }.bind(this),
          501
        )
      } else {
        this.focused = false
      }
    },
  },
}
</script>

<style>
.navbar-item {
  @apply w-auto h-full cursor-pointer overflow-hidden hover:overflow-visible items-center;
}

.menu-sub-col:hover > a {
  @apply text-blue-main;
}
.nuxt-link-active {
  @apply text-blue-main;
}

.nuxt-link-exact-active {
  @apply text-blue-main hover:text-blue-main;
}
.nuxt-link-active {
  @apply text-blue-main hover:text-blue-main;
}
</style>
